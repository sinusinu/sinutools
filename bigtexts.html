<!DOCTYPE html>
<html>
    <head>
        <title>Î©àÏ∂òÌÅ∞Í∏Ä</title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
        <meta property="og:title" content="Î©àÏ∂òÌÅ∞Í∏Ä" />
        <meta property="og:description" content="ÏãúÎàÑÏùò Ïû°ÎèôÏÇ¨Îãà ÎèÑÍµ¨Îì§" />
        <meta property="og:type" content="website" />
        <meta property="og:image" itemprop="image" content="thumbnails/bigtexts.png">
        <meta name="theme-color" media="(prefers-color-scheme: dark)" content="#16162c">
        <link rel="apple-touch-icon-precomposed" href="favicon57.png">
        <link rel="icon" href="favicon32.png">
        <link rel="stylesheet" href="common.css">
        <style>
            html, body {
                margin: 0;
                width: 100%;
                height: 100%;
                overflow: hidden;
            }
            .cont {
                width: 100%;
                height: 100%;
                display: flex;
                align-items: center;
                justify-content: center;
            }
            .bigtext {
                margin: 0;
                font-size: 5vw;
                line-height: 4.995vw;
                user-select: none;
                text-align: center;
            }
            .btn-settings {
                position: absolute;
                top: 16px;
                left: 20px;
                opacity: 75%;
                font-size: 32px;
                cursor: pointer;
                visibility: hidden;
            }
            .pane-settings {
                position: absolute;
                top: 16px;
                left: 20px;
                background-color: #000000A0;
                z-index: 1;
                border-radius: 12px;
                border: 3px #FFFFFF80 solid;
                padding: 8px;
            }
            .btn-close {
                background: lightgray;
                color: black;
                text-align: center;
                margin-top: 8px;
                padding: 4px;
                border-radius: 4px;
                font-size: 16px;
                cursor: pointer;
                user-select: none;
            }
            textarea {
                font-family: sans-serif;
                resize: none;
            }
        </style>
    </head>
    <body>
        <div id="btn-settings" class="btn-settings" onclick="showSettings()">‚öôÔ∏è</div>
        <div id="pane-settings" class="pane-settings">
            <div>ÌÖçÏä§Ìä∏</div>
            <div><textarea id="settings-text" type="text" value="Î©àÏ∂òÌÅ∞Í∏Ä" oninput="setText(this.value)"></textarea></div>
            <div style="height: 8px"></div>
            <div>ÌÅ¨Í∏∞</div>
            <div><input id="settings-size" type="range" min="1" max="50" value="5" oninput="setSize(this.value)"></div>            
            <div>ÌÖåÎßà</div>
            <div>
                <select id="settings-color" onchange="setColor(this.value)">
                    <option value="default">Í∏∞Î≥∏</option>
                    <option value="black-and-white">ÌùëÎ∞±</option>
                    <option value="in-the-dark">Ïñ¥Îë°Í≤å</option>
                    <option value="flashbang">ÎààÎ∂ÄÏã¨</option>
                    <option value="scarlet">Ï†ÅÏÉâ</option>
                </select>
            </div>
            <div class="btn-close" onclick="hideSettings(false)">Îã´Í∏∞</div>
            <div class="btn-close" onclick="hideSettings(true)">Îã´Í≥† Ïà®Í∏∞Í∏∞</div>
        </div>
        <div class="cont">
            <div id="bigboi" class="bigtext">Î©àÏ∂òÌÅ∞Í∏Ä</div>
        </div>
        <script>
            var bigboi = document.getElementById("bigboi");
            var btnSettings = document.getElementById("btn-settings");
            var paneSettings = document.getElementById("pane-settings");
            var settingsText = document.getElementById("settings-text");
            var settingsSize = document.getElementById("settings-size");
            var settingsColor = document.getElementById("settings-color");
            
            var isTextDynamic = false;
            var dynamicTextList = [];
            var activeUpdateFunctionRunnerId = -1;
            var regexDynamicToken = /\$\([^)\n]*\)/gm;

            var colors = {
                "default": {
                    back: null,
                    fore: null
                },
                "black-and-white": {
                    back: "black",
                    fore: "white"
                },
                "in-the-dark": {
                    back: "black",
                    fore: "#585858"
                },
                "flashbang": {
                    back: "white",
                    fore: "black"
                },
                "scarlet": {
                    back: "black",
                    fore: "#D32F2F"
                },
            };

            function setText(newText) {
                if (newText.trim().length == 0) {
                    return;
                }
                
                if (newText.match(regexDynamicToken)) {
                    var ntSplit = newText.split(regexDynamicToken);
                    var ntTokens = [...newText.matchAll(regexDynamicToken)];
                    dynamicTextList = [];
                    for (var i = 0; i < ntSplit.length; i++) {
                        dynamicTextList.push(ntSplit[i]);
                        if (i < ntTokens.length) dynamicTextList.push(ntTokens[i][0]);
                    }

                    updateText();
                    if (!isTextDynamic) activeUpdateFunctionRunnerId = window.setInterval(updateText, 1000);
                    isTextDynamic = true;
                } else {
                    if (isTextDynamic) clearInterval(activeUpdateFunctionRunnerId);
                    isTextDynamic = false;
                    bigboi.innerText = newText;
                }
            }

            function updateText() {
                var expandedDynamicText = "";
                for (var i = 0; i < dynamicTextList.length; i++) {
                    if (dynamicTextList[i].startsWith("$(")) {
                        var tokens = dynamicTextList[i].substr(2, dynamicTextList[i].length - 3).split(":");
                        if (tokens.length == 0) {
                            expandedDynamicText = expandedDynamicText + "ü§î";
                            continue;
                        }
                        switch (tokens[0]) {
                            case "time":
                                if (tokens.length == 1) {
                                    // no more tokens, just add current date with default toLocaleString
                                    expandedDynamicText = expandedDynamicText + new Date().toLocaleString();
                                } else {
                                    // use additional token to format time
                                    expandedDynamicText = expandedDynamicText + formatDate(tokens[1]);
                                }
                                break;
                            default:
                                expandedDynamicText = expandedDynamicText + "ü§î";
                                break;
                        }
                    } else {
                        expandedDynamicText = expandedDynamicText + dynamicTextList[i];
                    }
                }
                bigboi.innerText = expandedDynamicText;
            }
            
            function setSize(newSize) {
                bigboi.style.fontSize = newSize + "vw";
                bigboi.style.lineHeight = (newSize * 0.999) + "vw";
            }

            function setColor(newColor) {
                console.log(newColor);
                var color = colors[newColor];
                if (color === undefined) return;
                bigboi.style.color = color.fore;
                document.body.style.backgroundColor = color.back;
            }

            function hideSettings(shouldHideButton) {
                paneSettings.style.visibility = "hidden";
                btnSettings.style.visibility = "visible";
                btnSettings.style.opacity = (shouldHideButton == true) ? "5%" : "100%";
            }

            function showSettings() {
                paneSettings.style.visibility = "visible";
                btnSettings.style.visibility = "hidden";
            }

            // i know, i don't care, go away
            function formatDate(format) {
                var now = new Date();
                var ret = format;
                if (ret.includes("%Y"))  ret = ret.replaceAll("%Y",  now.getFullYear().toString().padStart(4, '0'));
                if (ret.includes("%y"))  ret = ret.replaceAll("%y",  now.getFullYear().toString().padStart(2, '0'));
                if (ret.includes("%m"))  ret = ret.replaceAll("%m",  now.getMonth().toString().padStart(2, '0'));
                if (ret.includes("%-m")) ret = ret.replaceAll("%-m", now.getMonth().toString());
                if (ret.includes("%d"))  ret = ret.replaceAll("%d",  now.getDate().toString().padStart(2, '0'));
                if (ret.includes("%-d")) ret = ret.replaceAll("%-d", now.getDate().toString());
                if (ret.includes("%a"))  ret = ret.replaceAll("%a",  ["Ïõî", "Ìôî", "Ïàò", "Î™©", "Í∏à", "ÌÜ†", "Ïùº"][now.getDay()]);
                if (ret.includes("%A"))  ret = ret.replaceAll("%A",  ["ÏõîÏöîÏùº", "ÌôîÏöîÏùº", "ÏàòÏöîÏùº", "Î™©ÏöîÏùº", "Í∏àÏöîÏùº", "ÌÜ†ÏöîÏùº", "ÏùºÏöîÏùº"][now.getDay()]);
                if (ret.includes("%p"))  ret = ret.replaceAll("%p",  (now.getHours() < 12 ? "Ïò§Ï†Ñ" : "Ïò§ÌõÑ"));
                if (ret.includes("%H"))  ret = ret.replaceAll("%H",  now.getHours().toString().padStart(2, '0'));
                if (ret.includes("%-H")) ret = ret.replaceAll("%-H", now.getHours().toString());
                if (ret.includes("%I"))  ret = ret.replaceAll("%I",  (now.getHours() == 12 ? 12 : now.getHours() % 12).toString().padStart(2, '0'));
                if (ret.includes("%-I")) ret = ret.replaceAll("%-I", (now.getHours() == 12 ? 12 : now.getHours() % 12).toString());
                if (ret.includes("%M"))  ret = ret.replaceAll("%M",  now.getMinutes().toString().padStart(2, '0'));
                if (ret.includes("%-M")) ret = ret.replaceAll("%-M", now.getMinutes().toString());
                if (ret.includes("%S"))  ret = ret.replaceAll("%S",  now.getSeconds().toString().padStart(2, '0'));
                if (ret.includes("%-S")) ret = ret.replaceAll("%-S", now.getSeconds().toString());
                if (ret.includes("%c"))  ret = ret.replaceAll("%c",  now.toLocaleString());
                if (ret.includes("%x"))  ret = ret.replaceAll("%x",  now.toLocaleDateString());
                if (ret.includes("%X"))  ret = ret.replaceAll("%X",  now.toLocaleTimeString());
                return ret;
            }

            settingsText.value = "Î©àÏ∂òÌÅ∞Í∏Ä";
            settingsSize.value = 5;
            settingsColor.value = "default";
        </script>
    </body>
</html>
