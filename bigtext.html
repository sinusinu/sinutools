<!DOCTYPE html>
<html>
    <head>
        <title>ÌùêÎ•¥ÎäîÌÅ∞Í∏Ä</title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
        <meta property="og:title" content="ÌùêÎ•¥ÎäîÌÅ∞Í∏Ä" />
        <meta property="og:description" content="ÏãúÎàÑÏùò Ïû°ÎèôÏÇ¨Îãà ÎèÑÍµ¨Îì§" />
        <meta property="og:type" content="website" />
        <meta property="og:image" itemprop="image" content="thumbnails/bigtext.png">
        <meta property="og:updated_time" content="1676275969" />
        <meta name="theme-color" media="(prefers-color-scheme: dark)" content="#16162c">
        <link rel="apple-touch-icon-precomposed" href="favicon57.png">
        <link rel="icon" href="favicon32.png">
        <link rel="stylesheet" href="common.css">
        <style>
            html, body {
                margin: 0;
                max-width: 100%;
                overflow: hidden;
            }
            .bigtext {
                font-size: 48vh;
                white-space: nowrap;
                margin: 0;
                position: absolute;
                top: 40%;
                transform: translateY(-40%);
                user-select: none;
            }
            .btn-settings {
                position: absolute;
                top: 16px;
                left: 20px;
                opacity: 75%;
                font-size: 32px;
                cursor: pointer;
                visibility: hidden;
            }
            .pane-settings {
                position: absolute;
                top: 16px;
                left: 20px;
                background-color: #000000A0;
                z-index: 1;
                border-radius: 12px;
                border: 3px #FFFFFF80 solid;
                padding: 8px;
            }
            .btn-close {
                background: lightgray;
                color: black;
                text-align: center;
                margin-top: 8px;
                padding: 4px;
                border-radius: 4px;
                font-size: 16px;
                cursor: pointer;
                user-select: none;
            }
        </style>
    </head>
    <body>
        <div id="btn-settings" class="btn-settings" onclick="showSettings()">‚öôÔ∏è</div>
        <div id="pane-settings" class="pane-settings">
            <div>ÌÖçÏä§Ìä∏</div>
            <div><input id="settings-text" type="text" value="ÌùêÎ•¥ÎäîÌÅ∞Í∏Ä" oninput="setText(this.value)"></div>
            <div style="height: 8px"></div>
            <div>Ïä§ÌÅ¨Î°§ ÏÜçÎèÑ</div>
            <div><input id="settings-speed" type="range" min="2" max="30" value="10" oninput="setSpeed(this.value)"></div>
            <div>ÌÖåÎßà</div>
            <div>
                <select id="settings-color" onchange="setColor(this.value)">
                    <option value="default">Í∏∞Î≥∏</option>
                    <option value="black-and-white">ÌùëÎ∞±</option>
                    <option value="in-the-dark">Ïñ¥Îë°Í≤å</option>
                    <option value="flashbang">ÎààÎ∂ÄÏã¨</option>
                    <option value="scarlet">Ï†ÅÏÉâ</option>
                </select>
            </div>
            <div style="margin-top: 4px;"><input id="settings-power" type="checkbox" onchange="setPowerMode(this.checked)"><label for="settings-power">Ï†ÑÏõê Ï†àÏïΩ</label></div>
            <div class="btn-close" onclick="hideSettings(false)">Îã´Í∏∞</div>
            <div class="btn-close" onclick="hideSettings(true)">Îã´Í≥† Ïà®Í∏∞Í∏∞</div>
        </div>
        <div id="bigboi" class="bigtext">ÌùêÎ•¥ÎäîÌÅ∞Í∏Ä</div>
        <script>
            var bigboi = document.getElementById("bigboi");
            var btnSettings = document.getElementById("btn-settings");
            var paneSettings = document.getElementById("pane-settings");
            var settingsText = document.getElementById("settings-text");
            var settingsSpeed = document.getElementById("settings-speed");
            var settingsColor = document.getElementById("settings-color");
            var settingsPower = document.getElementById("settings-power");

            var colors = {
                "default": {
                    back: null,
                    fore: null
                },
                "black-and-white": {
                    back: "black",
                    fore: "white"
                },
                "in-the-dark": {
                    back: "black",
                    fore: "#585858"
                },
                "flashbang": {
                    back: "white",
                    fore: "black"
                },
                "scarlet": {
                    back: "black",
                    fore: "#D32F2F"
                },
            };

            var lpos = 0;
            var scrollSpeed = 10;
            var renderSkipCounter = 0;
            var renderSkipValue = 0;

            var cachedBigboiWidth = 0;
            var cachedWindowWidth = 0;

            var isTextDynamic = false;
            var dynamicTextList = [];
            var activeUpdateFunctionRunnerId = -1;
            var regexDynamicToken = /\$\([^)\n]*\)/gm;

            function updateScreen() {
                if (renderSkipCounter == 0) {
                    renderSkipCounter = renderSkipValue;
                } else {
                    renderSkipCounter--;
                    window.requestAnimationFrame(updateScreen);
                    return;
                }
                lpos -= scrollSpeed * (renderSkipValue + 1);
                if (lpos < cachedBigboiWidth * -1.02) lpos = cachedWindowWidth * 1.02;
                bigboi.style.left = lpos + "px";
                window.requestAnimationFrame(updateScreen);
            };

            function setText(newText) {
                if (newText.trim().length == 0) {
                    return;
                }
                
                if (newText.match(regexDynamicToken)) {
                    var ntSplit = newText.split(regexDynamicToken);
                    var ntTokens = [...newText.matchAll(regexDynamicToken)];
                    dynamicTextList = [];
                    for (var i = 0; i < ntSplit.length; i++) {
                        dynamicTextList.push(ntSplit[i]);
                        if (i < ntTokens.length) dynamicTextList.push(ntTokens[i][0]);
                    }

                    updateText();
                    if (!isTextDynamic) activeUpdateFunctionRunnerId = window.setInterval(updateText, 1000);
                    isTextDynamic = true;
                } else {
                    if (isTextDynamic) clearInterval(activeUpdateFunctionRunnerId);
                    isTextDynamic = false;
                    bigboi.innerText = newText;
                    updateMetricsCache();
                }
            }
            
            function updateText() {
                var expandedDynamicText = "";
                for (var i = 0; i < dynamicTextList.length; i++) {
                    if (dynamicTextList[i].startsWith("$(")) {
                        var tokens = dynamicTextList[i].substr(2, dynamicTextList[i].length - 3).split(":");
                        if (tokens.length == 0) {
                            expandedDynamicText = expandedDynamicText + "ü§î";
                            continue;
                        }
                        switch (tokens[0]) {
                            case "time":
                                if (tokens.length == 1) {
                                    // no more tokens, just add current date with default toLocaleString
                                    expandedDynamicText = expandedDynamicText + new Date().toLocaleString();
                                } else {
                                    // use additional token to format time
                                    expandedDynamicText = expandedDynamicText + formatDate(tokens[1]);
                                }
                                break;
                            default:
                                expandedDynamicText = expandedDynamicText + "ü§î";
                                break;
                        }
                    } else {
                        expandedDynamicText = expandedDynamicText + dynamicTextList[i];
                    }
                }
                bigboi.innerText = expandedDynamicText;
                updateMetricsCache();
            }
            
            function setSpeed(newSpeed) {
                scrollSpeed = newSpeed;
            }

            function setColor(newColor) {
                console.log(newColor);
                var color = colors[newColor];
                if (color === undefined) return;
                bigboi.style.color = color.fore;
                document.body.style.backgroundColor = color.back;
            }

            function setPowerMode(savePower) {
                console.log(savePower);
                renderSkipValue = (savePower == true) ? 2 : 0;
            }

            function hideSettings(shouldHideButton) {
                paneSettings.style.visibility = "hidden";
                btnSettings.style.visibility = "visible";
                btnSettings.style.opacity = (shouldHideButton == true) ? "5%" : "100%";
            }

            function showSettings() {
                paneSettings.style.visibility = "visible";
                btnSettings.style.visibility = "hidden";
            }

            function updateMetricsCache() {
                cachedWindowWidth = document.body.clientWidth;
                cachedBigboiWidth = bigboi.clientWidth;
            }

            // i know, i don't care, go away
            function formatDate(format) {
                var now = new Date();
                var ret = format;
                
                // fast templates
                if (ret.includes("!hm"))  ret = ret.replaceAll("!hm", "%-IÏãú %MÎ∂Ñ");

                // individual tokens
                if (ret.includes("%Y"))  ret = ret.replaceAll("%Y",  now.getFullYear().toString().padStart(4, '0'));
                if (ret.includes("%y"))  ret = ret.replaceAll("%y",  now.getFullYear().toString().padStart(2, '0'));
                if (ret.includes("%m"))  ret = ret.replaceAll("%m",  now.getMonth().toString().padStart(2, '0'));
                if (ret.includes("%-m")) ret = ret.replaceAll("%-m", now.getMonth().toString());
                if (ret.includes("%d"))  ret = ret.replaceAll("%d",  now.getDate().toString().padStart(2, '0'));
                if (ret.includes("%-d")) ret = ret.replaceAll("%-d", now.getDate().toString());
                if (ret.includes("%a"))  ret = ret.replaceAll("%a",  ["Ïõî", "Ìôî", "Ïàò", "Î™©", "Í∏à", "ÌÜ†", "Ïùº"][now.getDay()]);
                if (ret.includes("%A"))  ret = ret.replaceAll("%A",  ["ÏõîÏöîÏùº", "ÌôîÏöîÏùº", "ÏàòÏöîÏùº", "Î™©ÏöîÏùº", "Í∏àÏöîÏùº", "ÌÜ†ÏöîÏùº", "ÏùºÏöîÏùº"][now.getDay()]);
                if (ret.includes("%p"))  ret = ret.replaceAll("%p",  (now.getHours() < 12 ? "Ïò§Ï†Ñ" : "Ïò§ÌõÑ"));
                if (ret.includes("%H"))  ret = ret.replaceAll("%H",  now.getHours().toString().padStart(2, '0'));
                if (ret.includes("%-H")) ret = ret.replaceAll("%-H", now.getHours().toString());
                if (ret.includes("%I"))  ret = ret.replaceAll("%I",  (now.getHours() == 12 ? 12 : now.getHours() % 12).toString().padStart(2, '0'));
                if (ret.includes("%-I")) ret = ret.replaceAll("%-I", (now.getHours() == 12 ? 12 : now.getHours() % 12).toString());
                if (ret.includes("%M"))  ret = ret.replaceAll("%M",  now.getMinutes().toString().padStart(2, '0'));
                if (ret.includes("%-M")) ret = ret.replaceAll("%-M", now.getMinutes().toString());
                if (ret.includes("%S"))  ret = ret.replaceAll("%S",  now.getSeconds().toString().padStart(2, '0'));
                if (ret.includes("%-S")) ret = ret.replaceAll("%-S", now.getSeconds().toString());
                if (ret.includes("%c"))  ret = ret.replaceAll("%c",  now.toLocaleString());
                if (ret.includes("%x"))  ret = ret.replaceAll("%x",  now.toLocaleDateString());
                if (ret.includes("%X"))  ret = ret.replaceAll("%X",  now.toLocaleTimeString());
                return ret;
            }

            settingsText.value = "ÌùêÎ•¥ÎäîÌÅ∞Í∏Ä";
            settingsSpeed.value = 10;
            settingsColor.value = "default";
            settingsPower.checked = false;
            updateMetricsCache();
            window.requestAnimationFrame(updateScreen);

            // optimized resize event
            // https://developer.mozilla.org/ko/docs/Web/API/Window/resize_event#requestanimationframe_customevent (minimized)
            !function(e,n,i){i=i||window;var t=!1;i.addEventListener(e,function(){t||(t=!0,requestAnimationFrame(function(){i.dispatchEvent(new CustomEvent(n)),t=!1}))})}("resize","optimizedResize");
            window.addEventListener("optimizedResize", updateMetricsCache);
        </script>
    </body>
</html>